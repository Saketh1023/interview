# Java Spring Boot API Coding Exercise

## Steps to get started:

#### Prerequisites
- Maven
- Java 1.8 (or higher, update version in pom.xml if needed)

#### Clone the project locally
- `https://github.com/tfuqua/interview.git`

#### Create your own branch and push to origin
- `[your_name]_crud_api`

#### Import project into IDE
- Project root is located in `backend` folder

#### Build and run your app
- `mvn package && java -jar target/interview-1.0-SNAPSHOT.jar`

#### Test that your app is running
- `curl -X GET   http://localhost:8080/api/welcome`

#### After finishing the goals listed below create a PR

### Goals
1. Design basic CRUD API with data store using Spring Boot and in memory H2 database (pre-configured, see below)
2. API should include one object with create, read, update, and delete operations. Read should include fetching a single item and list of items.
3. Provide SQL create scripts for your object(s) in resources/data.sql
4. Demo API functionality using API client tool

#### H2 Configuration
- Console: http://localhost:8080/h2-console 
- JDBC URL: jdbc:h2:mem:testdb
- Username: sa
- Password: password

## Project description

The project is build based on the Domain-Driven Design for implementing microservices.

### The application package
The application package contains all the inbound interactions(REST endpoints) and uses the domain package to access the model and services.

I have defined one logging aspect. Its job is to log around all REST endpoints and REST services. I would like to log the input, the output and how long the execution took. To exclude classes, methods, parameters or results from this logging mechanism specific annotations were defined.

I have defined a base class for all rest endpoints(AbstractCRUDResource) that contains the CRUD operations implemented in a generic way. By default, an implementation class will not inherit all the defined CRUD operations. For this to happen specifica annotations should be added manually.

The model data is not exposed directly to the client. Instead, I've created a DTO layer. In order to map the model to the dto I've used mapstruct. 

For this test project two RestControllers were defined UserResource(that handles user operations) and UserRelationshipResouce(that handles user relation operations)

To treat errors and have the same output format for the client I've created the ExceptionTranslator. Its job is to catch all errors that appear during a rest controller execution.

### The domain package
The domain package contains all the model classes and related business services.

All the data model is kept under the model package. We have on super class(AbstractAuditingEntity) that contains the basic fields. I've used the spring auditor to populate some generic fields.

The connection with the database is done using the repositories.

The business logic can be found in the services package. The base service for all model services is AbstractCRUDService that has the generic implementation for the CRUD operations.

For exception handling I've defined on exception(ApplicationException) that will be thrown, with specific details, from all services. This exception will be caught by the ExceptionTranslator from the application package.

### The tests

In order to test this demo application I've created a small testing framework. I've created some spring boot tests to validate the rest endpoints.

I've created CRUD tests for all the existing REST controllers.

To manually test the application I've created a small postman collection.

### Documentation

To have an api documentation I've used swagger. The generated documentation can be found at: http://localhost:8080/v2/api-docs. The ui version can be found at: http://localhost:8080/swagger-ui/

### Docker build

To build a docker container please use the following command from the backend folder: **docker build -t tekmetric:interview .**

### Monitoring

For monitoring the application I've enabled prometheus metrics to be generated by the spring boot.
Inside the /docker/prometheus folder there is a prometheus docker build file. This command should be used to build the docker image: **docker build -t tekmetric:prometheus .** This prometheus instance is autoconfigured to use the tekmetric app.

To visualize the prometheus metrics grafana is used. Inside the /docker/grafana folder there is a grafana docker build file. This command should be used to build the docker image: **docker build -t tekmetric:grafana .** The grafana instance is preconfigured with the prometheus datasource and a Spring Boot app dashboard
The username and password for grafana are: admin/admin

To start all docker images please check the docker compose file from the /docker folder. 

